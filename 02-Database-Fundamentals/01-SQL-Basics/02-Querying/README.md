# Queries

The goal of this exercise it to challenge your ability to make more complicated queries.

We will be using the same database as before so bring across your `.env`

```bash
cp ../01-Setup/.env .
```

If you stopped your docker container start it again making sure to use port `5410` again!

🎯 There will be five questions testing different aspects of sql select queries!

---

## Rental durations


**Backstory**: The company is considering adjusting its pricing strategy based on rental durations. Longer rental durations might indicate that customers are keeping movies for extended periods, either due to personal preference or because they find the current rental periods suitable. Understanding this behavior can help the company decide whether to introduce tiered pricing or offer extended rental packages.

**Problem Statement**: Identify customers who consistently keep their rentals for durations longer than the average customer. Generate a report with the following columns:
- **first_name**: The first name of the customer.
- **last_name**: The last name of the customer.
- **avg_duration**: The average duration, in days, that the customer keeps a rental.
- **quartile**: A quartile ranking based on their average rental duration compared to all customers (these should be represented as integers 1,2,3, and 4)

Ordered by **avg_duration** in descending order.

❓ Complete the query inside `rental_duration_query.sql`

Once you are done run

```
make test
```

Make sure you have 1/5 and then move on!


---

## Category performance

**Backstory**: The management team is considering adjusting their inventory based on the performance of different film categories. They need data on which categories generate the most revenue to make informed decisions.

**Problem Statement**: Classify film categories based on their total revenue and present the data in a table with the following columns:
- **name**: The name of the film category.
- **revenue**: The total revenue generated by the category.
- **revenue_category**: A classification label, either 'High', 'Medium', or 'Low', based on the revenue amount. With >1000 being 'High', >500 being 'Medium', and <=500 being 'Low'.

Order by **revenue** in descending order.

❓ Complete the query inside `category_performance_query.sql`

Once you are done run

```
make test
```

Make sure you have 2/5 and then move on!

---

**3.**
Certainly, here's the problem statement formatted according to your example:

---

**Backstory**: The management team wants to understand the weekly rental trends over a 5-month period. Given the short duration of the data, a finer granularity is required for a more accurate analysis. This information will help in planning inventory and marketing strategies.

**Problem Statement**: Analyze the weekly rentals and identify fluctuations and trends. Present the data in a table with the following columns:
- **week**: The starting date of the week.
- **rentals**: The total number of rentals for the week.
- **moving_avg_3weeks**: A 3-week moving average of the rentals to observe general trends.
- **difference**: The difference in rentals from the previous week to understand week-over-week changes.
- **deviation_from_avg**: The deviation of the number of rentals from the 3-week moving average, to identify if a particular week was an outlier or in line with general trends.


❓ Complete the query inside `weekly_trends_query.sql`

Once you are done run

```
make test
```

Make sure you have 3/5 and then move on!

---

**4.**

**Backstory**: The company has observed that certain actors frequently collaborate on projects. Recognizing frequent collaborations could be a unique selling point in marketing campaigns or special screening events.

**Problem Statement**: Determine which actor pairs frequently co-star in films together and display the results in a table with the following columns:
- **actor1**: The full name of the first actor in the pair.
- **actor2**: The full name of the second actor in the pair.
- **films_together**: The total number of films in which both actors have appeared together.

❓ Complete the query inside `co_stars_query.sql`

Once you are done run

```
make test
```

Make sure you have 4/5 and then move on!

---

**5.**

**Backstory**: The company is concerned about customer retention and is planning a re-engagement campaign. To target the campaign effectively, they need to identify customers who haven't been active recently.

**Problem Statement**: Find customers who haven't rented a film in the last 3 months and present the data in a table with the following columns:
- **full_name**: The combined first and last name of the customer.
- **last_rental_date**: The date when the customer last rented a film.
- **status**: An indicator, either 'Inactive' or 'Active', based on whether the customer has been inactive for more than 6 months.

❓ Complete the query inside `last_rental_query.sql`

Once you are done run

```
make test
```

Make sure you have 5/5 and then you are ready to move onto the next exercise!

## 🏁 Finished

This exercise has explored a lot of different types of select problems there will be lots of different ways to achieve the same result. Feel free to discuss your solutions with your peers and see if you can find a more efficient way to solve the problems!
